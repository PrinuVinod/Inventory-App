<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="assets/css/styles.css">
  <title>Karthika Nivas</title>
</head>

<body>
  <h1>Add Items</h1>

  <form id="addItemForm">
    <label for="items">Select Item:</label>
    <select id="items" name="items">
        <option value="">No Item</option>
        <option value="Big Banana">Big Banana</option>
        <option value="Bread">Bread</option>
        <option value="Curd">Curd</option>
        <option value="Cucumber">Cucumber</option>
        <option value="Garlic">Garlic</option>
        <option value="Lemon">Lemon</option>
        <option value="Milk packets">Milk Packets</option>
        <option value="Mint leaves">Mint Leaves</option>
        <option value="Orange">Orange</option>
        <option value="Potato">Potato</option>
        <option value="Small banana">Small Banana</option>
        <option value="Tomato">Tomato</option>
        <option value="Watermelon">Watermelon</option>
    </select>

    <label for="quantity">Select Quantity:</label>
    <select id="quantity" name="quantity">
        <option value="">No Quantity</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
    </select>

    <button type="button" onclick="addItem()">Add Item</button>
  </form>
  <hr>

  <div id="itemList">
    <h2 style="text-align-last: center;">List</h2>
    <table>
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Quantity</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="tableBody">
      </tbody>
    </table>
  </div>

  <script>
    async function addItem() {
      const selectedItem = document.getElementById('items').value;
      const selectedQuantity = document.getElementById('quantity').value;

      try {
        const response = await fetch('/addItem', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ itemname: selectedItem, quantity: selectedQuantity }),
        });

        const result = await response.json();
        alert(result.message);

        // Refresh the item list
        await fetchItems();
      } catch (error) {
        console.error('Error adding item:', error);
        alert('Error adding item. Please try again.');
      }
    }

    async function deleteItem(itemId) {
      try {
        const response = await fetch(`/deleteItem/${itemId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
          },
        });

        const result = await response.json();
        alert(result.message);

        // Refresh the item list
        await fetchItems();
      } catch (error) {
        console.error('Error deleting item:', error);
        alert('Error deleting item. Please try again.');
      }
    }

    async function fetchItems() {
      try {
        const response = await fetch('/getItems');
        const result = await response.json();

        const itemList = document.getElementById('itemList');
        itemList.innerHTML = '<h2>Inventory List</h2>';

        result.items.forEach(item => {
          itemList.innerHTML += `
            <p>${item.itemname} - Quantity: ${item.quantity}
            <button onclick="deleteItem('${item._id}')">Delete</button></p>`;
        });
      } catch (error) {
        console.error('Error fetching items:', error);
        alert('Error fetching items. Please try again.');
      }
    }

    fetchItems();
  </script>

</body>
</html>